# NgRx Schematics Collection

This Angular schematics collection provides code generators for NgRx state management patterns. It includes multiple schematics to help you quickly scaffold NgRx store structures following best practices.

## Available Schematics

### 1. ngrx-event

Generates a complete NgRx event store structure including actions, reducer, selectors, and effects for a given feature.

### 2. ngrx-signal

Generates NgRx Signal Store structure for modern Angular signal-based state management.

## ngrx-event Schematic

### Generated Files

When you run the `ngrx-event` schematic, it creates the following files:

```
feature-name/
├── index.ts                    # Barrel exports
├── feature-name.actions.ts     # NgRx actions
├── feature-name.reducer.ts     # NgRx reducer with state interface
├── feature-name.selectors.ts   # NgRx selectors
├── feature-name.effects.ts     # NgRx effects (with placeholders for service calls)
└── feature-name.actions.spec.ts # Unit tests (generated by default, can be skipped)
```

## Installation

1. **Build the schematics collection**:

```bash
npm run build
```

2. **Use the schematics from the project**:

```bash
# From the schematics directory
schematics .:ngrx-event --name=feature-name

# From outside the schematics directory (provide path to collection)
schematics path/to/ngrx:ngrx-event --name=feature-name
```

## Usage

### Basic Usage

```bash
# Generate NgRx event store for a user feature
schematics .:ngrx-event --name=user
```

This creates a `user` folder with all NgRx files for user management.

### Options

| Option      | Type    | Default | Description                                                    |
| ----------- | ------- | ------- | -------------------------------------------------------------- |
| `name`      | string  | -       | The name of the feature/module (required if not auto-detected) |
| `path`      | string  | `""`    | The path to create the store files                             |
| `skipTests` | boolean | `true`  | Skip creating test files                                       |
| `flat`      | boolean | `false` | Create files at the top level of the path                      |

### Examples

#### Auto-detect name from current folder

```bash
# If you're in a folder called 'products'
schematics .:ngrx-event
# Creates: products/products.actions.ts, products.reducer.ts, etc.
```

#### Include test files

```bash
schematics .:ngrx-event --name=order --skip-tests=false
```

#### Create files without subfolder (flat structure)

```bash
schematics .:ngrx-event --name=customer --flat
# Creates: customer.actions.ts, customer.reducer.ts, etc. (no customer/ subfolder)
```

#### Specify custom path

```bash
schematics .:ngrx-event --name=product --path=./src/store
```

## Generated Code Features

### Actions

- **CRUD Operations**: Create, Read (Load), Update, Delete
- **Loading States**: Actions for loading, success, and failure states
- **Selection**: Actions for selecting and clearing selection
- **Type Safety**: All actions are strongly typed with props

### Reducer

- **State Interface**: Complete state interface with loading, error, and data arrays
- **Immutable Updates**: Uses NgRx createReducer with proper immutable state updates
- **Error Handling**: Proper error state management
- **Selection State**: Manages selected item state

### Selectors

- **Feature Selector**: Main feature state selector
- **Derived Selectors**: Selectors for data arrays, loading state, errors, selected items
- **By ID Selector**: Utility selector to find items by ID

### Effects

- **Service Placeholders**: Ready-to-use effect structure with service call placeholders
- **Error Handling**: Proper error handling with catchError operators
- **Different Strategies**: Uses switchMap for loading, mergeMap for CRUD operations

## Integration Steps

After generating the files, you'll need to:

1. **Install NgRx dependencies** (if not already installed):

```bash
npm install @ngrx/store @ngrx/effects @ngrx/entity
```

2. **Add to your module**:

```typescript
import { StoreModule } from "@ngrx/store";
import { EffectsModule } from "@ngrx/effects";
import { userReducer, UserEffects } from "./path-to-generated-files";

@NgModule({
  imports: [
    StoreModule.forFeature("user", userReducer),
    EffectsModule.forFeature([UserEffects]),
  ],
})
export class FeatureModule {}
```

3. **Create your service** and replace the placeholder service calls in the effects

4. **Update the state interface** to match your actual data model

5. **Use in components**:

```typescript
import { Store } from '@ngrx/store';
import { selectUsers, loadUsers } from './path-to-generated-files';

@Component({...})
export class UserComponent {
  users$ = this.store.select(selectUsers);

  constructor(private store: Store) {}

  ngOnInit() {
    this.store.dispatch(loadUsers());
  }
}
```

## ngrx-signal Schematic

### Generated Files

When you run the `ngrx-signal` schematic, it creates the following files:

```
feature-name/
├── index.ts                    # Barrel exports
├── feature-name.store.ts       # NgRx Signal Store with state and methods
├── feature-name.service.ts     # HTTP service for API calls
└── feature-name.store.spec.ts  # Unit tests (generated by default, can be skipped)
```

### Usage

#### Basic Usage

```bash
# Generate NgRx Signal Store for a user feature
schematics .:ngrx-signal --name=user
```

This creates a `+state` folder with Signal Store files for user management.

### Options

The ngrx-signal schematic uses the same options as ngrx-event:

| Option      | Type    | Default | Description                                                    |
| ----------- | ------- | ------- | -------------------------------------------------------------- |
| `name`      | string  | -       | The name of the feature/module (required if not auto-detected) |
| `path`      | string  | `""`    | The path to create the store files                             |
| `skipTests` | boolean | `true`  | Skip creating test files                                       |
| `flat`      | boolean | `false` | Create files at the top level of the path                      |

### Examples

```bash
# Basic usage
schematics .:ngrx-signal --name=product

# Include test files
schematics .:ngrx-signal --name=order --no-skip-tests

# Create files without subfolder (flat structure)
schematics .:ngrx-signal --name=customer --flat

# Specify custom path
schematics .:ngrx-signal --name=inventory --path=./src/stores
```

### Generated Code Features

#### Signal Store

- **Signal-based State**: Uses Angular signals for reactive state management
- **Computed Signals**: Derived state using computed signals
- **State Patching**: Immutable state updates using patchState
- **Async Methods**: Uses rxMethod for handling async operations
- **Type Safety**: Fully typed state and methods

#### Service

- **HTTP Operations**: Complete CRUD operations using HttpClient
- **Type Safety**: Strongly typed HTTP requests and responses
- **Injectable**: Ready to inject with providedIn: 'root'

#### Integration

The generated Signal Store is ready to use and can be injected directly:

```typescript
import { Component, inject } from "@angular/core";
import { UserStore } from "./+state/user.store";

@Component({
  selector: "app-user-list",
  template: `
    <div>
      <h2>Users ({{ userStore.userCount() }})</h2>
      <div *ngIf="userStore.isLoading()">Loading...</div>
      <div *ngIf="userStore.error()">Error: {{ userStore.error() }}</div>

      <ul>
        <li
          *ngFor="let user of userStore.users()"
          (click)="userStore.selectUser(user.id)"
          [class.selected]="user.id === userStore.selectedId()"
        >
          {{ user.name }}
        </li>
      </ul>

      <div *ngIf="userStore.selectedUser() as selected">
        Selected: {{ selected.name }}
      </div>
    </div>
  `,
})
export class UserListComponent {
  userStore = inject(UserStore);
}
```

### Prerequisites

To use the generated Signal Store, ensure you have the required dependencies:

```bash
npm install @ngrx/signals
```

For Angular 17+, you can use the Signal Store pattern with:

```typescript
// In your app.config.ts or main.ts
import { provideHttpClient } from "@angular/common/http";

export const appConfig: ApplicationConfig = {
  providers: [
    provideHttpClient(),
    // other providers...
  ],
};
```

## Development

### Building the Schematics

To build the schematics collection:

```bash
npm run build
```

### Testing the Schematics

To test the schematic with dry-run (preview changes without writing files):

```bash
schematics .:ngrx-event --name=test --dry-run
```

### Running Tests

To run the unit tests:

```bash
npm test
```

## Project Structure

```
src/
├── collection.json              # Schematics collection configuration
├── ngrx/                       # Basic NgRx schematic
├── ngrx-event/                 # Event store schematic
│   ├── files/                  # Template files
│   ├── index.ts               # Schematic factory
│   ├── index_spec.ts          # Tests
│   └── schema.json            # Options schema
└── ngrx-signal/               # Signal store schematic
```
